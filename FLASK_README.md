# Flask Приложение - Многостраничный интерфейс

Это Flask-версия приложения для анализа движений младенцев, реализующая полноценную многостраничность для избежания проблем с видимостью компонентов.

## Преимущества Flask версии

- ✅ **Полноценная многостраничность** - каждая страница рендерится отдельно
- ✅ **Нет проблем с видимостью компонентов** - каждая страница имеет свой URL
- ✅ **Простая навигация** - стандартные HTTP редиректы
- ✅ **Сессии Flask** - надежное управление состоянием аутентификации
- ✅ **RESTful API** - четкое разделение между страницами и API endpoints

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Убедитесь, что Flask установлен:
```bash
pip install flask flask-session werkzeug
```

## Запуск

### Вариант 1: Через скрипт запуска
```bash
python run_flask.py
```

### Вариант 2: Напрямую через Flask
```bash
python app.py
```

### Вариант 3: Через Flask CLI
```bash
flask run
```

Приложение будет доступно по адресу: **http://127.0.0.1:5000**

## Структура приложения

```
├── app.py                 # Основное Flask приложение
├── flask_analysis.py      # Логика анализа для Flask
├── run_flask.py           # Скрипт запуска
├── templates/             # HTML шаблоны
│   ├── base.html         # Базовый шаблон
│   ├── login.html        # Страница входа
│   ├── register.html    # Страница регистрации
│   └── main.html         # Главная страница анализа
├── static/               # Статические файлы
│   ├── css/
│   │   ├── style.css    # Основные стили
│   │   └── analysis.css # Стили для страницы анализа
│   └── js/
│       ├── main.js      # Основной JavaScript
│       └── analysis.js  # JavaScript для анализа
├── uploads/              # Загруженные видео
└── results/             # Результаты анализа
```

## Маршруты

### Страницы

- `/` - Главная (редирект на login или main)
- `/login` - Страница входа
- `/register` - Страница регистрации
- `/main` - Главная страница анализа (требует аутентификации)
- `/logout` - Выход из системы

### API Endpoints

- `POST /api/load_models` - Загрузка моделей ML
- `POST /api/upload_video` - Загрузка видео файла
- `POST /api/analyze` - Запуск анализа видео
- `GET /api/check_status` - Проверка статуса системы
- `GET /results/<filename>` - Получение результатов анализа

## Использование

1. **Вход/Регистрация**: Перейдите на `/login` или `/register`
2. **Загрузка моделей**: После входа нажмите "Загрузить модели" на главной странице
3. **Загрузка видео**: Перетащите видео или выберите файл
4. **Указание параметров**: Введите возраст ребенка и гестационный возраст
5. **Запуск анализа**: Нажмите "Запустить анализ движений"
6. **Просмотр результатов**: После завершения анализа отобразятся результаты

## Отличия от Gradio версии

| Аспект | Gradio | Flask |
|--------|--------|------|
| Архитектура | Одностраничное приложение | Многостраничное приложение |
| Навигация | Управление видимостью компонентов | Отдельные URL для каждой страницы |
| Аутентификация | Проблемы с видимостью кнопок | Стандартные сессии Flask |
| Рендеринг | Клиентский (JavaScript) | Серверный (Jinja2) |
| API | Встроенный в Gradio | RESTful API endpoints |

## Решение проблем

### Проблема: "Модели не загружены"
**Решение**: Нажмите кнопку "Загрузить модели" на главной странице. Убедитесь, что GPU доступен.

### Проблема: "Видео не загружено"
**Решение**: Убедитесь, что вы загрузили видео на шаге 1 перед переходом к шагу 2.

### Проблема: "Ошибка анализа"
**Решение**: 
- Проверьте, что модели загружены
- Убедитесь, что видео файл валиден
- Проверьте логи в консоли сервера

## Конфигурация

Настройки можно изменить в `app.py`:

```python
app.config['UPLOAD_FOLDER'] = 'uploads'  # Директория для загрузок
app.config['MAX_CONTENT_LENGTH'] = 500 * 1024 * 1024  # Максимальный размер файла (500 MB)
```

## Безопасность

⚠️ **Важно**: В продакшене измените `SECRET_KEY`:

```python
app.secret_key = os.environ.get('SECRET_KEY', 'your-secret-key-here')
```

## Разработка

Для разработки с автоматической перезагрузкой:

```bash
export FLASK_DEBUG=True
python run_flask.py
```

Или:

```bash
flask run --debug
```
